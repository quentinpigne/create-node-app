const app: Koa = new Koa();

{{#if pinoLogger}}
app.use(koaPino());
{{/if}}
app.use(morgan('dev'));
{{#if routing}}

app.use(routes());
{{/if}}
{{#if serveStatic}}
app.use(serve(path.resolve(__dirname, '../../public')));
{{/if}}

app.use(async (ctx: Koa.ParameterizedContext, next: Koa.Next) => {
  switch (ctx.request.url) {
    {{#if helloEndpointNoRouting}}
    case '/hello':
      hello(ctx, next);
      break;
    {{/if}}
    {{#if monitoring}}
    case '/metrics':
      const metrics = await register.metrics();
      ctx.response.body = metrics;
      break;
    {{/if}}
    default:
      ctx.response.status = 404;
      ctx.response.body = JSON.stringify({ message: 'Not Found' });
  }
});
