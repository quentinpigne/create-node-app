const nconf = require('nconf');
{{> (headersPartial)}}

const logger = require('../../lib/logger')
{{#if routing}}
const routes = require('../../app/routes');
{{/if}}

module.exports = function (callback) {
  const port = nconf.get('NODE_PORT');
  {{> (corePartial)}}

  {{#if noFramework}}server{{else}}app{{/if}}
    .listen(port, () => {
      logger.info(`[SERVER] Listening on port ${port}`);
      callback();
    })
    .on('error', function (error) {
      if (error.code === 'EADDRINUSE') {
        logger.error(`[SERVER] Port ${port} is busy`);
      }
      callback(error);
    });
}
